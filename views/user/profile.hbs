<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>

<body style="background-image: url('img_girl.jpg');">
    <ul class="nav justify-content-center pt-md-2">
        <li class="nav-item">
            <a class="nav-link active" href="#">profile</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Exams</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Jobs</a>
        </li>

        <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"> hello Mr.{{username}}</a>
        </li>
        <li class="nav-item">


            <!--A CIRCLE LIKE BUTTON TO DISPLAY NOTIFICATION DROPDOWN.-->
            <div id="noti_Button"></div>

            <!--THE NOTIFICAIONS DROPDOWN BOX.-->
            <div id="notifications">
                <h3>Notifications</h3>
                <div style="height:480px;" id="notficationList">
                </div>

                <div class="seeAll"><a href="#">See All</a></div>
            </div>
        </li>
    </ul>
    <hr>
    <div class="container">
        <div class="row col-md-11 pt-4">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Title</th>
                        <th scope="col">Apply</th>
                    </tr>
                </thead>
                <tbody>
                    {{#positions}}
                    <tr>
                        <td>{{this.title}}</td>
                        <td>
                            <a href="#my_modal" id="btn{{this.id}}" class="btn btn-primary" data-toggle="modal"
                                data-pos-id="{{this.id}}" data-book-id="{{this.description}}">Apply</a>
                        </td>
                    </tr>
                    {{/positions}}
                </tbody>
            </table>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="my_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Apply</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <!-- Modal -->
                <form method="post" action="fileupload" enctype="multipart/form-data" id="myform">
                    <div class="modal-body">
                        <p class="desc"></p>
                        <input value="" type="text" name="stId " id="stId">
                        <div class="custom-file">
                            <label class="custom-file-label" for="file">Choose your CV</label>
                            <input type="file" class="custom-file-input CV" id="file" name="filetoupload" /><br>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary uploadCV">Upload</button>

                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>


        jQuery(document).ready(function () {
            // id of the button id="but_upload"
            jQuery('#my_modal').on('show.bs.modal', function (e) {
                var bookId = jQuery(e.relatedTarget).data('book-id');
                var posId = jQuery(e.relatedTarget).data('pos-id');
                jQuery(e.currentTarget).find('.desc').append(bookId);
                jQuery(e.currentTarget).find('#stId').val(posId);
            });
            var pressed_btn_id;
            $("a").click(function () {
                pressed_btn_id = this.id;
            });
            $('#upload_btn').click(function () {
                $("#" + pressed_btn_id).removeClass('btn-primary').addClass('btn-success disabled ');

                //  $(this).addClass('btn-success').removeClass('btn-primary ');
            });

            jQuery('button#but_upload').click(function (e) {
                e.preventDefault();
                var fd = new FormData();
                var files = $('#file')[0].files[0];
                var PosId = $("input[name='myId']");
                fd.append('file', files);
                fd.append('posId', PosId);
                $.ajax({
                    url: "/uploadCV",
                    method: 'post',
                    data: {
                        name: "ahmed",
                        age: 20
                    },
                    success: function (result) {
                        if (result.success) {
                            suc(availableHours);
                        }
                        else
                            alert(result.failed);
                    }
                });
            });
        });
    </script>


    <style>
        #noti_Container {
            position: relative;
        }

        /* A CIRCLE LIKE BUTTON IN THE TOP MENU. */
        #noti_Button {
            width: 22px;
            height: 22px;
            line-height: 22px;
            border-radius: 50%;
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
            background: black;
            margin: -3px 10px 0 10px;
            cursor: pointer;
        }

        /* THE POPULAR RED NOTIFICATIONS COUNTER. */
        #noti_Counter {
            display: block;
            position: absolute;
            background: #E1141E;
            color: #FFF;
            font-size: 12px;
            font-weight: normal;
            padding: 1px 3px;
            margin: -8px 0 0 25px;
            border-radius: 2px;
            -moz-border-radius: 2px;
            -webkit-border-radius: 2px;
            z-index: 1;
        }

        /* THE NOTIFICAIONS WINDOW. THIS REMAINS HIDDEN WHEN THE PAGE LOADS. */
        #notifications {
            display: none;
            width: 430px;
            position: absolute;
            top: 30px;
            left: 860px;
            background:white;
            border: solid 1px rgba(100, 100, 100, .20);
            -webkit-box-shadow: 0 3px 8px rgba(0, 0, 0, .20);
            z-index: 10;
        }

        /* AN ARROW LIKE STRUCTURE JUST OVER THE NOTIFICATIONS WINDOW */
        #notifications:before {
            content: '';
            display: block;
            width: 0;
            height: 0;
            color: transparent;
            border: 10px solid black;
            border-color: transparent transparent black;
            margin-top: -20px;
            margin-left: 10px;
        }



        .seeAll {
            background: #F6F7F8;
            padding: 8px;
            font-size: 12px;
            font-weight: bold;
            border-top: solid 1px rgba(100, 100, 100, .30);
            text-align: center;
        }

        .BodyNotify {
            background: #F6F7F8;
            padding: 8px;
            font-size: 12px;
            font-weight: bold;
            border-top: solid 1px rgba(100, 100, 100, .30);
            text-align: left;
        }

        .seeAll a {
            color: #3b5998;
        }

        .seeAll a:hover {
            background: #F6F7F8;
            color: #3b5998;
            text-decoration: underline;
        }
    </style>
    <script>
        $("#notifications").on("click", "a", function () {
            $.get('/notifcationDetails', { 'id': $(this).attr('id') }, (data) => {
                alert(data[0].body)
            })
        });
        $(document).ready(function () {
            // ANIMATEDLY DISPLAY THE NOTIFICATION COUNTER.
            $('#noti_Counter')
                .css({ opacity: 0 })
                .text('5')  // ADD DYNAMIC VALUE (YOU CAN EXTRACT DATA FROM DATABASE OR XML).
                .css({ top: '-10px' })
                .animate({ top: '-2px', opacity: 1 }, 500);

            $('#noti_Button').click(function () {

                // TOGGLE (SHOW OR HIDE) NOTIFICATION WINDOW.
                $('#notifications').fadeToggle('fast', 'linear', function () {
                    if ($('#notifications').is(':hidden')) {
                        $('#noti_Button').css('background-color', '#2E467C');

                    }
                    // CHANGE BACKGROUND COLOR OF THE BUTTON.
                    else {

                        
                        $.get('/notifcation', (data, status) => {
                            for (var i = 0; i < data.length; i++) {
                                var ht = '';

                                ht += '<div class="BodyNotify" style="height:60px; height: 8%;">'
                                ht += '<a style="font-weight: bold;font-size: 14px;" id="' + data[i].notfiID + '">' + data[i].title + ' </a>';
                                ht += '<a style="font-weight: bold;font-size: 12px;"id="' + data[i].notfiID + '">send to you from - ' + data[i].from + ':</a>'
                                ht += ' <a style="font-weight: bold;font-size: xx-small;"id="' + data[i].notfiID + '">' + data[i].body + '</a></div>';

                            }
                            $('#notficationList').html(ht);
                        })
                    }
                });


                return false;
            });

            // HIDE NOTIFICATIONS WHEN CLICKED ANYWHERE ON THE PAGE.
            $(document).click(function () {
                $('#notifications').hide();

               
            });

            $('#notifications').click(function () {
                return false;       // DO NOTHING WHEN CONTAINER IS CLICKED.
            });
        });
    </script>
</body>